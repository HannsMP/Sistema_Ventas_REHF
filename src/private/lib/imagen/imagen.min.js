class DataImage{constructor(t){this.file=t}async toBuffer(){let t=await this.file.arrayBuffer();return{destination:this.file.webkitRelativePath||null,buffer:new Uint8Array(t),lastModified:this.file.lastModified,originalname:this.file.name,mimetype:this.file.type,size:this.file.size}}}class ImageManager{ev=new EventListener;#a;#b=void 0;files=[];constructor(t,e={multi:!1,autohide:!1,justChange:!1}){this.input=t,this.#a=e,t.style.display="none",this.imgBox=document.createElement("section"),this.imgBox.classList.add("img-box","bx","bx-image"),this.isDisabled=t.hasAttribute("disabled"),this.upload=document.createElement("div"),this.upload.classList.add("upload"),this.upload.innerHTML=`<span>Subir (${t.accept})</span>`,this.upload.addEventListener("click",()=>this.input.click()),this.input.addEventListener("change",()=>this.create()),this.isDisabled?this.input.parentNode.append(this.imgBox):this.input.parentNode.append(this.imgBox,this.upload),document.addEventListener("keydown",({key:t})=>{if(this.#b){if("Escape"===t)return this.#c();"ArrowLeft"===t&&this.#a.multi&&this.#d("left"),"ArrowRight"===t&&this.#a.multi&&this.#d("right")}});let i=this.input.getAttribute("default");if(i)return this.imgBox.style.backgroundImage=`url(${i})`;let s=this.input.getAttribute("value");s&&this.charge(s),this.#a.autohide&&(this.upload.style.display="none")}state(t){t?(this.input.parentNode.append(this.upload),this.input.setAttribute("disabled","")):(this.upload.remove(),this.input.removeAttribute("disabled")),this.isDisabled=!t}#d(t){("left"===t||"right"===t)&&this.ev.emit(t,null)}#e(e){if(e.classList.contains("full-screen"))return this.#c();e.classList.add("full-screen"),this.#b=e,this.ev.emit("fullScreen",e)}#c(){this.#b&&(this.#b.classList.remove("full-screen"),this.#b=void 0,this.ev.emit("fullScreen",null))}create(){let t=this.input.files[0];if(t){let e=new DataImage(t),i=new FileReader;i.onload=t=>{let i=document.createElement("div");i.classList.add("img","upload");let s=document.createElement("img");if(s.src=t.target.result,i.addEventListener("click",()=>this.#e(i)),i.append(s),!this.#a.justChange){let a=document.createElement("a");a.innerHTML="<i class='bx bx-x'></i>",a.classList.add("close"),a.addEventListener("click",()=>this.#f(i,e)),i.append(a)}!this.#a.multi&&(this.empty(),this.ev.emit("change",i),this.#a.autohide&&(this.upload.style.display="none")),this.imgBox.append(i),this.files.push(e),this.ev.emit("insert",e)},i.readAsDataURL(t)}}#f(i,s){s&&(this.files=this.files.filter(t=>t!==s)),i.remove(),this.ev.emit("remove",i),console.log(this.#a),!this.#a.multi&&this.#a.autohide&&(this.upload.style.display="")}empty(){this.files=[],this.imgBox.innerHTML=""}charge(t){let e=document.createElement("div");e.classList.add("img","charge");let i=document.createElement("img");if(i.src=t,e.addEventListener("click",()=>this.#e(e)),e.append(i),!this.#a.justChange&&!this.isDisabled){let s=document.createElement("a");s.innerHTML="<i class='bx bx-x'></i>",s.classList.add("close"),s.addEventListener("click",()=>this.#f(e)),e.append(s)}!this.#a.multi&&(this.empty(),this.ev.emit("change",e),this.#a.autohide&&(this.upload.style.display="none")),this.imgBox.append(e)}}