(()=>{class e{#a={};emit(e,...t){if("string"!=typeof e)throw TypeError('El nombre de emit debe ser un "string"');let s=this.#a[e];s?.length&&(this.#a[e]=s.filter(e=>(e.callback(...t),e.persistence||!e.once)))}on(e,t,s){if("string"!=typeof e)throw TypeError('El nombre del evento debe ser un "string"');if("function"!=typeof t)throw TypeError('El callback del evento debe ser una "funcion"');this.#a[e]||(this.#a[e]=[]),this.#a[e].push({callback:t,once:s?.once,persistence:s?.persistence})}off(e,t){if("string"!=typeof e)throw TypeError('El nombre del evento debe ser un "string"');if("function"!=typeof t)throw TypeError('El eventFun del evento debe ser una "funcion"');let s=this.#a[e];s?.length&&(s=s.filter(e=>e!=t))}empty(e){if("string"!=typeof e)throw TypeError('El nombre de remove debe ser un "string"');this.#a[e]&&(this.#a[e]=this.#a[e].filter(e=>e.persistence))}}class t extends e{#b;#c=[];#d=[20,0,0];invisible={};indexer={};constructor(e,t=!1){super(),this.menuBox=document.createElement("div"),this.menuBox.className="selector-menu scroll-y",this.menuBox.innerHTML='<span class="menu-warn"></span>',this.menuWarn=this.menuBox.querySelector(".menu-warn"),this.#b=t,e.forEach(({id:e,name:t,src:s})=>this.add(e,t,s)),this.menuBox.addEventListener("scroll",()=>{let{scrollTop:e,clientHeight:t,scrollHeight:s}=this.menuBox;e+t<s||this.#e()}),this._selectedId=e=>{let t=this.indexer[e];this.emit("click",t),t.selected=1,t.selectorBox.remove(),this.draw(),t.closeAnchor.addEventListener("click",()=>{this.emit("close",t),t.selected=0,t.seletedBox.remove(),this.draw()},{once:!0})},this.menuBox.addEventListener("click",e=>{let t=e.target.closest(".menu-index");if(!t)return;let s=t.dataset.id;this._selectedId(s)})}#f(s,i,n){let l={id:s,name:i,src:n},h=l.selectorBox=document.createElement("div");h.dataset.id=s,h.className="menu-index",h.innerHTML=this.#b?"img"==this.#b?`<img src="${n}"><span>${i}</span>`:`<small>${s}</small><span>${i}</span>`:`<span>${i}</span>`;let r=l.seletedBox=document.createElement("div");return r.innerHTML=`<span>${i}</span><a><i class="bx bx-x"></i></a>`,l.closeAnchor=r.querySelector("a"),l}add(e,t,s){this.indexer.hasOwnProperty(e)||this.invisible.hasOwnProperty(e)||(this.indexer[e]=this.#f(e,t,s))}upd(e,t){let s;if(this.indexer.hasOwnProperty(e))s=this.indexer;else{if(!this.invisible.hasOwnProperty(e))return;s=this.invisible}let{selectorBox:i,seletedBox:n,name:l,src:h}=s[e];"img"==this.#b&&(i.querySelector("img").src=t.src||h),n.querySelector("span").textContent=i.querySelector("span").textContent=t.name||l}rmv(e){let t;if(this.indexer.hasOwnProperty(e))t=this.indexer;else{if(!this.invisible.hasOwnProperty(e))return;t=this.invisible}let{selectorBox:s,seletedBox:i}=t[e];this.emit("close",t[e]),i.remove(),s.remove(),delete t[e]}has(e){return this.indexer.hasOwnProperty(e)||this.invisible.hasOwnProperty(e)}show(e){this.invisible.hasOwnProperty(e)&&(this.indexer[e]=this.invisible[e],delete this.invisible[e],this.draw())}hide(e){if(!this.indexer.hasOwnProperty(e))return;let{selectorBox:t,seletedBox:s}=this.invisible[e]=this.indexer[e];s.remove(),t.remove(),delete this.indexer[e]}forEach(e){for(let t in this.indexer)e(this.indexer[t],t)}reset(){this.forEach(e=>{e.selected=0,e.seletedBox.remove(),e.selectorBox.remove()})}search(e=""){"string"==typeof e&&(this.#c=[],this.emit("search",e),this.menuWarn.style.display="none",""==e?(this.forEach((e,t)=>{1!=e.selected&&(this.#c.push(t),e.selected=0)}),this.#c.length||(this.menuWarn.style.display="",this.menuWarn.textContent="Sin datos.")):(this.forEach((t,s)=>{if(1!=t.selected){if(!t.name.toLowerCase().includes(e.toLowerCase()))return t.selected=-1;this.#c.push(s),t.selected=0}}),this.#c.length||(this.menuWarn.style.display="",this.menuWarn.textContent="Sin coincidencia.")),this.draw())}draw(e="asc"){this.#c.length&&("asc"==e&&this.#c.sort((e,t)=>(e=this.indexer[e]?.name)<(t=this.indexer[t]?.name)?-1:e>t?1:0),"des"==e&&this.#c.sort((e,t)=>(e=this.indexer[e]?.name)<(t=this.indexer[t]?.name)?1:e>t?-1:0)),this.#d[1]=0,this.#d[2]=this.#c.length,this.forEach(({selectorBox:e,selected:t})=>{0!=t&&e.remove()}),this.#e()}#e(){let o=this.#d[0]*this.#d[1],c=o+this.#d[0];if(this.#d[2]<o)return;let d=this.#c.slice(o,c).filter(e=>this.indexer.hasOwnProperty(e));this.menuBox.append(...d.map(e=>this.indexer[e].selectorBox)),this.#d[1]++}}class a extends e{selected=[];constructor(e,s,i=!1){if("INPUT"!=e.tagName)throw TypeError("El elemento no es un input.");if(!s instanceof t)throw TypeError("Es necesario el parametro Selector.");if(super(),this.inputElement=e,this.selectorClass=s,this.autoHide=i,this.isDisabled=this.inputElement.hasAttribute("disabled"),e.insertAdjacentHTML("beforebegin",'<div class="selected-colletion"></div>'),this.colletionBox=e.previousElementSibling,!this.isDisabled){s.on("click",t=>{if(s.menuBox.parentNode!=e.parentNode)return;let n=this.selected[0];n&&(n.closeAnchor.click(),this.emit("change",n)),this.colletionBox.append(t.seletedBox),this.emit("selected",t),this.selected[0]=t,i&&(e.style.display="none")},{persistence:!0}),s.on("close",t=>{t.seletedBox.closest(".selected-colletion")==this.colletionBox&&(this.emit("diselected",t),i&&(e.style.display=""))},{persistence:!0});let n;this.inputElement.addEventListener("input",t=>{clearTimeout(n),n=setTimeout(()=>{this.emit("input",e.value),s.search(e.value)},500)}),this.inputElement.addEventListener("focusin",t=>{this.emit("focusin",t),this.inputElement.parentNode.append(s.menuBox),s.search(e.value)}),this.inputElement.addEventListener("focusout",e=>{this.emit("focusout",e),setTimeout(()=>{s.menuBox.remove()},200)})}}select(e){if(!this.selectorClass.indexer.hasOwnProperty(e))return;this.selectorClass._selectedId(e),this.autoHide&&(this.inputElement.style.display="none"),this.selected[0]&&(this.emit("diselected",this.selected[0]),this.selected[0].closeAnchor.click(),this.emit("change",this.selected[0]));let t=this.selectorClass.indexer[e];this.colletionBox.append(t.seletedBox),this.emit("selected",t),this.selected[0]=t}diselect(e){this.selectorClass.has(e)&&this.selected[0].id==e&&(this.autoHide&&(this.inputElement.style.display=""),this.emit("diselected",this.selected[0]),this.selected[0].closeAnchor.click())}empty(){this.selected.length&&(this.emit("diselected",this.selected[0]),this.selected[0].closeAnchor.click())}}class u extends e{selected=[];constructor(e,s){if("INPUT"!=e.tagName)throw TypeError("El elemento no es un input.");if(!s instanceof t)throw TypeError("Es necesario el parametro Selector.");if(super(),this.inputElement=e,this.selectorClass=s,this.isDisabled=this.inputElement.hasAttribute("disabled"),e.insertAdjacentHTML("beforebegin",'<div class="selected-colletion"></div>'),this.colletionBox=e.previousElementSibling,!this.isDisabled){s.on("click",t=>{s.menuBox.parentNode==e.parentNode&&(this.colletionBox.append(t.seletedBox),this.emit("selected",t),this.selected.push(t))},{persistence:!0}),s.on("close",e=>{if(e.seletedBox.closest(".selected-colletion")!=this.colletionBox)return;let t=this.selected.findIndex(t=>t==e);this.emit("diselected",e),this.selected.splice(t,1)},{persistence:!0});let i;this.inputElement.addEventListener("input",t=>{clearTimeout(i),i=setTimeout(()=>{this.emit("input",e.value),s.search(e.value)},500)}),this.inputElement.addEventListener("focusin",t=>{this.emit("focusin",t),this.inputElement.parentNode.append(s.menuBox),s.search(e.value)}),this.inputElement.addEventListener("focusout",e=>{this.emit("focusout",e),setTimeout(()=>{s.menuBox.remove()},200)})}}select(e){if(!this.selectorClass.indexer.hasOwnProperty(e))return;this.selectorClass._selectedId(e);let t=this.selectorClass.indexer[e];this.colletionBox.append(t.seletedBox),this.emit("selected",t),this.selected.push(t)}diselect(e){if(!this.selectorClass.has(e))return;let t=this.selected.findIndex(t=>t.id==e),s=this.selected[t];this.emit("diselected",s),s.closeAnchor.click(),this.selected.splice(t,1)}empty(){this.selected.length&&this.selected.forEach(e=>{this.emit("diselected",e),e.closeAnchor.click()})}}window.Selector=t,window.SelectorUnic=a,window.SelectorMulti=u})();