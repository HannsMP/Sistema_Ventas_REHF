class Catalogue{ev=new EventListener;#a=new Map;#b="asc";#c=!1;#d={};#e=0;#f=0;#g=0;#h=0;constructor(t,i,a,e=20){this.fetchCallback=i,this.factoryCallback=a,this.#f=e,t.classList.add("catalogue-content"),t.innerHTML='<div class="catalogue-header"><div class="catalogue-details"><span class="paginator-length"></span><span class="paginator-show"></span></div><div class="catalogue-controls"><button class="btn-sort"><i class="bx bx-sort-a-z"></i></button><button class="btn-visibility"><i class="bx bx-show"></i></button></div></div><div class="catalogue-grid"></div><div class="catalogue-footer"><div class="catalogue-paginator"></div></div>',this.catalogoBox=t,this.catalogoGrid=t.querySelector(".catalogue-grid"),this.paginatorLength=t.querySelector(".paginator-length"),this.paginatorShow=t.querySelector(".paginator-show"),this.catalogoPaginator=t.querySelector(".catalogue-paginator"),this.sortButton=t.querySelector(".btn-sort"),this.visibilityButton=t.querySelector(".btn-visibility"),this.sortButton.addEventListener("click",()=>this.#i().draw()),this.visibilityButton.addEventListener("click",()=>this.#j().draw())}set order(t){this.#b="asc"==t?"asc":"desc",this.#i(this.#b)}set visibility(t=!0){this.#c=!!t,this.#j(this.#c)}get orderGet(){return this.#b}get visibilityGet(){return this.#c}#i(t="asc"===this.#b?"desc":"asc"){this.#b=t,this.ev.emit("order",t);let i="asc"===this.#b?"bx-sort-a-z":"bx-sort-z-a";return this.sortButton.querySelector("i").className=`bx ${i}`,this}#j(a=!this.#c){this.#c=a,this.ev.emit("visibility",a);let e=this.#c?"bx-show":"bx-hide";return this.visibilityButton.querySelector("i").className=`bx ${e}`,this}set(t,i,a=!0){if(!this.#a.has(t))return;let e=this.#a.get(t);"function"==typeof i?i(e.data):a&&(e.data={...e.data,...i}),e.productHTML.innerHTML=this.factoryCallback(e.data)}delete(t){if(this.#a.has(t))this.#a.get(t).productHTML.remove(),this.#a.delete(t)}filter(t){return this.ev.emit("search",t),this.#d=t,this}draw(t=this.#g){this.#e++;let i={draw:this.#e,filter:this.#d,order:this.#b,visibility:this.#c,start:this.#f*t,length:this.#f};return this.ev.emit("load",i),this.fetchCallback(i,a=>{i.draw==a.draw&&(this.ev.emit("complete",a),this.#g=t,this.#h=a.recordsTotal||0,this.#k(a),this.#l())}),this.#e}#k({data:s=[],draw:r}){let h=0,o=new Set(s.map(t=>t.id));this.#a.forEach((t,i)=>{t.productHTML.remove(),o.has(i)||this.#a.delete(i)});if(!s.every(t=>{if(r!=this.#e)return!1;let i=this.#a.has(t.id),a=i?this.#a.get(t.id).productHTML:document.createElement("div");return i||(a.classList.add("product-box"),a.id=t.id),a.innerHTML=this.factoryCallback(t),this.#a.set(t.id,{data:t,productHTML:a}),this.catalogoGrid.append(a),h++,!0}))return;let n=this.#f*this.#g;this.paginatorLength.innerText=`Mostrando de ${n+1} a ${n+h}, de ${this.#h} entradas`,this.paginatorShow.innerText=`Visibles ${h}`}#l(){let l=Math.ceil(this.#h/this.#f);this.catalogoPaginator.innerHTML="",this.catalogoPaginator.append(this.#m("Primero",()=>this.draw(0),0===this.#g)),this.catalogoPaginator.append(this.#m("Anterior",()=>this.draw(this.#g-1),0===this.#g));for(let c=Math.max(0,this.#g-2);c<=Math.min(l-1,this.#g+2);c++){let d=this.#m(c+1,()=>this.draw(c),c===this.#g);c===this.#g&&d.classList.add("active"),this.catalogoPaginator.append(d)}this.catalogoPaginator.append(this.#m("Siguiente",()=>this.draw(this.#g+1),this.#g===l-1)),this.catalogoPaginator.append(this.#m("\xdaltimo",()=>this.draw(l-1),this.#g===l-1))}#m(u,g,b=!1){let v=document.createElement("button");return v.className="pag",v.innerText=u,v.disabled=b,v.addEventListener("click",g),v}}